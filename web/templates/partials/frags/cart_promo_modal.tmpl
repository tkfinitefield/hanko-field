{{ define "cart_promo_modal_body" }}
{{ $lang := .Lang }}
<form class="space-y-4"
      hx-post="/cart:apply-promo"
      hx-target="#modal-root"
      hx-swap="innerHTML">
  {{ if .StatusText }}
    <div class="rounded-lg border {{ if eq .StatusTone "success" }}border-emerald-200 bg-emerald-50 text-emerald-900{{ else }}border-red-200 bg-red-50 text-red-900{{ end }} px-3 py-2 text-sm">
      {{ .StatusText }}
    </div>
  {{ end }}
  <label class="block text-sm font-medium text-gray-700">
    {{ if eq $lang "ja" }}プロモコード{{ else }}Promo code{{ end }}
    <input type="text"
           name="promo_code"
           value="{{ if .Attempt }}{{ .Attempt }}{{ else if .Promo.ActiveCode }}{{ .Promo.ActiveCode }}{{ end }}"
           placeholder="{{ .Promo.Placeholder }}"
           class="mt-2 w-full rounded-lg border border-gray-200 px-3 py-2 text-base focus:border-indigo-500 focus:ring-indigo-500">
  </label>
  <button type="submit" class="inline-flex w-full items-center justify-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500">
    {{ if eq $lang "ja" }}適用する{{ else }}Apply{{ end }}
  </button>
  <div class="space-y-2 rounded-lg border border-gray-100 bg-gray-50 p-3">
    <p class="text-xs font-semibold uppercase tracking-wide text-gray-500">{{ if eq $lang "ja" }}利用可能なコード{{ else }}Available codes{{ end }}</p>
    <ul class="space-y-1 text-sm text-gray-700">
      {{ range .Promo.Suggestions }}
        <li class="flex items-start justify-between gap-2 rounded-md border border-dashed border-gray-200 px-3 py-2">
          <div>
            <p class="font-semibold text-gray-900">{{ .Code }}</p>
            <p class="text-xs text-gray-500">{{ .Description }}</p>
          </div>
          <span class="rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600">{{ .Label }}</span>
        </li>
      {{ end }}
    </ul>
  </div>
</form>
{{ end }}

{{ define "cart_promo_modal_footer" }}
<button type="button" class="inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100" data-modal-close>
  {{ if eq .Lang "ja" }}閉じる{{ else }}Close{{ end }}
</button>
{{ end }}

{{ define "frag_cart_promo_modal" }}
{{ $title := "" }}
{{ if eq .Lang "ja" }}
  {{ $title = "プロモコード" }}
{{ else }}
  {{ $title = "Apply promo" }}
{{ end }}
{{ template "c_modal" (dict
  "ID" "cart-promo-modal"
  "Title" $title
  "BodyTmpl" "cart_promo_modal_body"
  "BodyData" .
  "FooterTmpl" "cart_promo_modal_footer"
  "FooterData" (dict "Lang" .Lang)
) }}
{{ end }}
